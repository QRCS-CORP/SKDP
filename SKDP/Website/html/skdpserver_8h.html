<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SKDP: Symmetric Key Distribution Protocol: C:/Users/stepp/Documents/Visual Studio 2022/Projects/C/SKDP/SKDP/skdpserver.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="skdp_extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SKDP: Symmetric Key Distribution Protocol<span id="projectnumber">&#160;1.1.0.0 (A1)</span>
   </div>
   <div id="projectbrief">Encrypted tunneling protocol using pre-shared keys</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('skdpserver_8h.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">skdpserver.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>The SKDP listener.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;common.h&quot;</code><br />
<code>#include &quot;<a class="el" href="skdp_8h_source.html">skdp.h</a>&quot;</code><br />
<code>#include &quot;../../QSC/QSC/rcs.h&quot;</code><br />
<code>#include &quot;../../QSC/QSC/socketserver.h&quot;</code><br />
</div>
<p><a href="skdpserver_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structskdp__server__state.html">skdp_server_state</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The SKDP server state structure.  <a href="structskdp__server__state.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a5a91fb2a6bcf84681796ca9222bc1bb9" id="r_a5a91fb2a6bcf84681796ca9222bc1bb9"><td class="memItemLeft" align="right" valign="top"><a id="a5a91fb2a6bcf84681796ca9222bc1bb9" name="a5a91fb2a6bcf84681796ca9222bc1bb9"></a>
typedef SKDP_EXPORT_API struct skdp_server_state&#160;</td><td class="memItemRight" valign="bottom"><b>skdp_server_state</b></td></tr>
<tr class="separator:a5a91fb2a6bcf84681796ca9222bc1bb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad92d1cfa6a2e1d682c6ae773242e533e" id="r_ad92d1cfa6a2e1d682c6ae773242e533e"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad92d1cfa6a2e1d682c6ae773242e533e">skdp_server_connection_close</a> (<a class="el" href="structskdp__server__state.html">skdp_server_state</a> *ctx, qsc_socket *sock, <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a> error)</td></tr>
<tr class="memdesc:ad92d1cfa6a2e1d682c6ae773242e533e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close the remote session and dispose of server resources.  <br /></td></tr>
<tr class="separator:ad92d1cfa6a2e1d682c6ae773242e533e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0aafc73e5fe1c1943c342a21c25f28cb" id="r_a0aafc73e5fe1c1943c342a21c25f28cb"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0aafc73e5fe1c1943c342a21c25f28cb">skdp_server_send_error</a> (const qsc_socket *sock, <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a> error)</td></tr>
<tr class="memdesc:a0aafc73e5fe1c1943c342a21c25f28cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an error code to the remote host.  <br /></td></tr>
<tr class="separator:a0aafc73e5fe1c1943c342a21c25f28cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11300f76037cba1e7bbc60b418f384e9" id="r_a11300f76037cba1e7bbc60b418f384e9"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a11300f76037cba1e7bbc60b418f384e9">skdp_server_send_keep_alive</a> (skdp_keep_alive_state *kctx, const qsc_socket *sock)</td></tr>
<tr class="memdesc:a11300f76037cba1e7bbc60b418f384e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a keep-alive message to the remote host.  <br /></td></tr>
<tr class="separator:a11300f76037cba1e7bbc60b418f384e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a957f3d5e2a96eb6b257c5726d32d63c5" id="r_a957f3d5e2a96eb6b257c5726d32d63c5"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a957f3d5e2a96eb6b257c5726d32d63c5">skdp_server_initialize</a> (<a class="el" href="structskdp__server__state.html">skdp_server_state</a> *ctx, const <a class="el" href="structskdp__server__key.html">skdp_server_key</a> *skey)</td></tr>
<tr class="memdesc:a957f3d5e2a96eb6b257c5726d32d63c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the SKDP server state.  <br /></td></tr>
<tr class="separator:a957f3d5e2a96eb6b257c5726d32d63c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb92ce548cf98ba322b3cb566787e3ea" id="r_afb92ce548cf98ba322b3cb566787e3ea"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afb92ce548cf98ba322b3cb566787e3ea">skdp_server_listen_ipv4</a> (<a class="el" href="structskdp__server__state.html">skdp_server_state</a> *ctx, qsc_socket *sock, const qsc_ipinfo_ipv4_address *address, uint16_t port)</td></tr>
<tr class="memdesc:afb92ce548cf98ba322b3cb566787e3ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the IPv4 networked key exchange function.  <br /></td></tr>
<tr class="separator:afb92ce548cf98ba322b3cb566787e3ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2201345a285b4cd9ebbee5074b88dcf6" id="r_a2201345a285b4cd9ebbee5074b88dcf6"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2201345a285b4cd9ebbee5074b88dcf6">skdp_server_listen_ipv6</a> (<a class="el" href="structskdp__server__state.html">skdp_server_state</a> *ctx, qsc_socket *sock, const qsc_ipinfo_ipv6_address *address, uint16_t port)</td></tr>
<tr class="memdesc:a2201345a285b4cd9ebbee5074b88dcf6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the IPv6 networked key exchange function.  <br /></td></tr>
<tr class="separator:a2201345a285b4cd9ebbee5074b88dcf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa9aaf212e9d4e09c2ed4b37ba20ff2b" id="r_aaa9aaf212e9d4e09c2ed4b37ba20ff2b"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaa9aaf212e9d4e09c2ed4b37ba20ff2b">skdp_server_decrypt_packet</a> (<a class="el" href="structskdp__server__state.html">skdp_server_state</a> *ctx, const <a class="el" href="structskdp__network__packet.html">skdp_network_packet</a> *packetin, uint8_t *message, size_t *msglen)</td></tr>
<tr class="memdesc:aaa9aaf212e9d4e09c2ed4b37ba20ff2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decrypt a received SKDP packet.  <br /></td></tr>
<tr class="separator:aaa9aaf212e9d4e09c2ed4b37ba20ff2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ae05196b9f9bfab988d6bcca2fdc135" id="r_a3ae05196b9f9bfab988d6bcca2fdc135"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3ae05196b9f9bfab988d6bcca2fdc135">skdp_server_encrypt_packet</a> (<a class="el" href="structskdp__server__state.html">skdp_server_state</a> *ctx, const uint8_t *message, size_t msglen, <a class="el" href="structskdp__network__packet.html">skdp_network_packet</a> *packetout)</td></tr>
<tr class="memdesc:a3ae05196b9f9bfab988d6bcca2fdc135"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encrypt a message into an SKDP packet.  <br /></td></tr>
<tr class="separator:a3ae05196b9f9bfab988d6bcca2fdc135"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12db25a989b17e3ee383acce52f501b7" id="r_a12db25a989b17e3ee383acce52f501b7"><td class="memItemLeft" align="right" valign="top">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a12db25a989b17e3ee383acce52f501b7">skdp_server_ratchet_response</a> (<a class="el" href="structskdp__server__state.html">skdp_server_state</a> *ctx, <a class="el" href="structskdp__network__packet.html">skdp_network_packet</a> *packetout)</td></tr>
<tr class="memdesc:a12db25a989b17e3ee383acce52f501b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a ratchet response to the client.  <br /></td></tr>
<tr class="separator:a12db25a989b17e3ee383acce52f501b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The SKDP listener. </p>
<p>This header defines the internal server functions for the Symmetric Key Distribution Protocol (SKDP). The SKDP listener is responsible for handling incoming connections from SKDP clients, managing the key exchange process, and maintaining secure communications. The functions in this header support both IPv4 and IPv6 connections, manage encryption and decryption of messages, and handle key ratcheting operations to periodically update session keys for forward secrecy.</p>
<p>The server operates by accepting incoming connection requests, performing the key exchange with each client, and then maintaining an encrypted tunnel. The server also manages keep-alive messages and error reporting to ensure robust communication.</p>
<dl class="section note"><dt>Note</dt><dd>These functions and data structures are internal and non-exportable. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad92d1cfa6a2e1d682c6ae773242e533e" name="ad92d1cfa6a2e1d682c6ae773242e533e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad92d1cfa6a2e1d682c6ae773242e533e">&#9670;&#160;</a></span>skdp_server_connection_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API void skdp_server_connection_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structskdp__server__state.html">skdp_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qsc_socket *</td>          <td class="paramname"><span class="paramname"><em>sock</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a></td>          <td class="paramname"><span class="paramname"><em>error</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close the remote session and dispose of server resources. </p>
<p>This function gracefully closes the SKDP server session by terminating the connection on the given socket and releasing any resources associated with the server state. It sends an error code to the remote host (if applicable) before closing the connection.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>A pointer to the SKDP server state structure. </td></tr>
    <tr><td class="paramname">sock</td><td>A pointer to the initialized socket structure. </td></tr>
    <tr><td class="paramname">error</td><td>The SKDP error code indicating the reason for closure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aaa9aaf212e9d4e09c2ed4b37ba20ff2b" name="aaa9aaf212e9d4e09c2ed4b37ba20ff2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa9aaf212e9d4e09c2ed4b37ba20ff2b">&#9670;&#160;</a></span>skdp_server_decrypt_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a> skdp_server_decrypt_packet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structskdp__server__state.html">skdp_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structskdp__network__packet.html">skdp_network_packet</a> *</td>          <td class="paramname"><span class="paramname"><em>packetin</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>message</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *</td>          <td class="paramname"><span class="paramname"><em>msglen</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decrypt a received SKDP packet. </p>
<p>This function decrypts the message contained in an incoming SKDP network packet using the server's current decryption state. The decrypted plaintext is copied into the provided output buffer, and its length is returned through the msglen parameter.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>A pointer to the SKDP server state structure. </td></tr>
    <tr><td class="paramname">packetin</td><td>[const] A pointer to the incoming SKDP network packet. </td></tr>
    <tr><td class="paramname">message</td><td>The output buffer where the decrypted message will be stored. </td></tr>
    <tr><td class="paramname">msglen</td><td>A pointer to a variable that will receive the length of the decrypted message.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns a value of type <code><a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b" title="The SKDP error values.">skdp_errors</a></code> indicating the result of the decryption operation. </dd></dl>

</div>
</div>
<a id="a3ae05196b9f9bfab988d6bcca2fdc135" name="a3ae05196b9f9bfab988d6bcca2fdc135"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ae05196b9f9bfab988d6bcca2fdc135">&#9670;&#160;</a></span>skdp_server_encrypt_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a> skdp_server_encrypt_packet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structskdp__server__state.html">skdp_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>message</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>msglen</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structskdp__network__packet.html">skdp_network_packet</a> *</td>          <td class="paramname"><span class="paramname"><em>packetout</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encrypt a message into an SKDP packet. </p>
<p>This function encrypts a plaintext message using the server's current transmit cipher state. It then builds an SKDP network packet with the encrypted data, including appropriate header information (e.g., message length, sequence number, and UTC timestamp).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>A pointer to the SKDP server state structure. </td></tr>
    <tr><td class="paramname">message</td><td>[const] The plaintext message to be encrypted. </td></tr>
    <tr><td class="paramname">msglen</td><td>The length of the plaintext message in bytes. </td></tr>
    <tr><td class="paramname">packetout</td><td>A pointer to the output SKDP network packet structure.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns a value of type <code><a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b" title="The SKDP error values.">skdp_errors</a></code> indicating the success or failure of the encryption process. </dd></dl>

</div>
</div>
<a id="a957f3d5e2a96eb6b257c5726d32d63c5" name="a957f3d5e2a96eb6b257c5726d32d63c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a957f3d5e2a96eb6b257c5726d32d63c5">&#9670;&#160;</a></span>skdp_server_initialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API void skdp_server_initialize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structskdp__server__state.html">skdp_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structskdp__server__key.html">skdp_server_key</a> *</td>          <td class="paramname"><span class="paramname"><em>skey</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the SKDP server state. </p>
<p>This function initializes the SKDP server state structure using the provided server key. It configures the necessary cipher states and copies key information into the server state, preparing it for the key exchange process and subsequent secure communications.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>A pointer to the SKDP server state structure to be initialized. </td></tr>
    <tr><td class="paramname">skey</td><td>[const] A pointer to the SKDP server key structure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afb92ce548cf98ba322b3cb566787e3ea" name="afb92ce548cf98ba322b3cb566787e3ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb92ce548cf98ba322b3cb566787e3ea">&#9670;&#160;</a></span>skdp_server_listen_ipv4()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a> skdp_server_listen_ipv4 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structskdp__server__state.html">skdp_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qsc_socket *</td>          <td class="paramname"><span class="paramname"><em>sock</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const qsc_ipinfo_ipv4_address *</td>          <td class="paramname"><span class="paramname"><em>address</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>port</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run the IPv4 networked key exchange function. </p>
<p>This function starts the SKDP server listener on an IPv4 interface. It waits for a client connection, performs the key exchange, and, upon successful completion, returns a connected socket along with an updated SKDP server state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>A pointer to the SKDP server state structure. </td></tr>
    <tr><td class="paramname">sock</td><td>A pointer to the socket structure that will hold the connected socket. </td></tr>
    <tr><td class="paramname">address</td><td>A pointer to the server's IPv4 network address. </td></tr>
    <tr><td class="paramname">port</td><td>The server's port number.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns a value of type <code><a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b" title="The SKDP error values.">skdp_errors</a></code> indicating the success or failure of the IPv4 key exchange. </dd></dl>

</div>
</div>
<a id="a2201345a285b4cd9ebbee5074b88dcf6" name="a2201345a285b4cd9ebbee5074b88dcf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2201345a285b4cd9ebbee5074b88dcf6">&#9670;&#160;</a></span>skdp_server_listen_ipv6()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a> skdp_server_listen_ipv6 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structskdp__server__state.html">skdp_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qsc_socket *</td>          <td class="paramname"><span class="paramname"><em>sock</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const qsc_ipinfo_ipv6_address *</td>          <td class="paramname"><span class="paramname"><em>address</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>port</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run the IPv6 networked key exchange function. </p>
<p>This function starts the SKDP server listener on an IPv6 interface. It accepts a client connection, performs the key exchange protocol, and returns a connected socket along with an updated SKDP server state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>A pointer to the SKDP server state structure. </td></tr>
    <tr><td class="paramname">sock</td><td>A pointer to the socket structure that will hold the connected socket. </td></tr>
    <tr><td class="paramname">address</td><td>A pointer to the server's IPv6 network address. </td></tr>
    <tr><td class="paramname">port</td><td>The server's port number.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns a value of type <code><a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b" title="The SKDP error values.">skdp_errors</a></code> indicating the outcome of the IPv6 key exchange. </dd></dl>

</div>
</div>
<a id="a12db25a989b17e3ee383acce52f501b7" name="a12db25a989b17e3ee383acce52f501b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12db25a989b17e3ee383acce52f501b7">&#9670;&#160;</a></span>skdp_server_ratchet_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a> skdp_server_ratchet_response </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structskdp__server__state.html">skdp_server_state</a> *</td>          <td class="paramname"><span class="paramname"><em>ctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structskdp__network__packet.html">skdp_network_packet</a> *</td>          <td class="paramname"><span class="paramname"><em>packetout</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a ratchet response to the client. </p>
<p>In SKDP, a ratchet response is used to send an encrypted token to the client and re-key the communication channel. This mechanism is useful in static tunnel configurations where additional entropy is periodically injected based on uptime or data transfer. The function constructs a ratchet response packet using the current server state and sends it to the client.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>A pointer to the SKDP server state structure. </td></tr>
    <tr><td class="paramname">packetout</td><td>A pointer to the output SKDP network packet structure that will contain the ratchet response.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns a value of type <code><a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b" title="The SKDP error values.">skdp_errors</a></code> indicating the outcome of the ratchet response operation. </dd></dl>

</div>
</div>
<a id="a0aafc73e5fe1c1943c342a21c25f28cb" name="a0aafc73e5fe1c1943c342a21c25f28cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0aafc73e5fe1c1943c342a21c25f28cb">&#9670;&#160;</a></span>skdp_server_send_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API void skdp_server_send_error </td>
          <td>(</td>
          <td class="paramtype">const qsc_socket *</td>          <td class="paramname"><span class="paramname"><em>sock</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a></td>          <td class="paramname"><span class="paramname"><em>error</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send an error code to the remote host. </p>
<p>This function sends a specified SKDP error code over the given socket to notify the remote host of an error condition.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sock</td><td>A pointer to the initialized socket structure. </td></tr>
    <tr><td class="paramname">error</td><td>The SKDP error code to be transmitted. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a11300f76037cba1e7bbc60b418f384e9" name="a11300f76037cba1e7bbc60b418f384e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11300f76037cba1e7bbc60b418f384e9">&#9670;&#160;</a></span>skdp_server_send_keep_alive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SKDP_EXPORT_API <a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b">skdp_errors</a> skdp_server_send_keep_alive </td>
          <td>(</td>
          <td class="paramtype">skdp_keep_alive_state *</td>          <td class="paramname"><span class="paramname"><em>kctx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const qsc_socket *</td>          <td class="paramname"><span class="paramname"><em>sock</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a keep-alive message to the remote host. </p>
<p>This function sends a keep-alive message using the current SKDP keep-alive state over the provided socket. This mechanism is used to verify that the connection is still active and to maintain the session.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">kctx</td><td>A pointer to the SKDP keep-alive state structure. </td></tr>
    <tr><td class="paramname">sock</td><td>A pointer to the initialized socket structure.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns a value of type <code><a class="el" href="skdp_8h.html#a941c4d5a2c383c51c315a3b65d7ab91b" title="The SKDP error values.">skdp_errors</a></code> indicating the result of the keep-alive send operation. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_11a2b35b32cf64f0531b234e6700c197.html">SKDP</a></li><li class="navelem"><a class="el" href="skdpserver_8h.html">skdpserver.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
